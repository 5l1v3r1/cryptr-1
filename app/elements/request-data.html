<dom-module id="request-data">
	<template>

		<iron-ajax id="getPolicy"
			url="{{getPoliciesURL}}"
			handle-as="json"
			headers="{{header}}"
			on-response="_policySuccess">
		</iron-ajax>

	</template>
	<script>
		(function() {
			'use strict';
			Polymer({
				is: 'request-data',
                properties: {
                    status: {
    					notify: true,
    					observer: '_watchStatus'
    				},
    				data: {
    					notify: true
    				},
					access: {
						type: Object,
						value: {}
					},
					header: Object,
					initialResponse: Array
				},
				_policySuccess: function(e) {
					var rules = hcltojson(e.detail.response.data.rules).path;
					for (var key in rules) {
						for (var i = 0; i < this.initialResponse.policies.length; i++) {
							if (key == 'sys/policy/' + this.initialResponse.policies[i]) delete rules[key];
						}
						if (key in rules) this.access[key] = rules[key];
					}
				},
    			_watchStatus: function() {
    				if (this.status != 'none' && this.status != '') {
						if (this.initialResponse.policies.length > 0) {
							for (var i = 0; i < this.initialResponse.policies.length; i++) {
								this.getPoliciesURL = app.url + 'v1/sys/policy/' + this.initialResponse.policies[i];
								this.$.getPolicy.generateRequest();
							}
						}
					}
    			}
			});
		})();
	</script>
</dom-module>
